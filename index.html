<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>4ä¸ªæœˆå‡é‡ç‰¹è®­è®¡åˆ’</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <!-- å¼•å…¥ Markdown è§£æåº“ (å¯é€‰ï¼Œç”¨äºç¾åŒ– AI è¾“å‡º) -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 320px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 400px;
            }
        }
        .stat-card {
            background-color: #ffffff;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            padding: 1.5rem;
            text-align: center;
        }
        .stat-number {
            font-size: 3rem;
            font-weight: 800;
            line-height: 1;
        }
        .stat-label {
            font-size: 1rem;
            font-weight: 500;
            color: #4B5563;
        }
        /* AI Section Styles */
        .ai-gradient {
            background: linear-gradient(135deg, #004080 0%, #00A6AD 100%);
        }
        .loader {
            border: 3px solid #f3f3f3;
            border-radius: 50%;
            border-top: 3px solid #005A8D;
            width: 20px;
            height: 20px;
            -webkit-animation: spin 1s linear infinite; /* Safari */
            animation: spin 1s linear infinite;
            display: inline-block;
            vertical-align: middle;
            margin-right: 8px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .table-row-animate {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div class="container mx-auto p-4 md:p-8 max-w-7xl">

        <header class="text-center mb-12">
            <h1 class="text-4xl md:text-5xl font-bold text-[#004080] mb-4">ğŸ¯ 39å²èŒåœºç”·æ€§å‡é‡ç‰¹è®­è®¡åˆ’</h1>
            <p class="text-xl text-gray-600">(ç³–å°¿ç—…+ç—›é£ç‰¹åˆ«ç‰ˆ)</p>
        </header>

        <!-- Weight Tracker Section (New) -->
        <section class="mb-12 bg-white rounded-xl shadow-lg overflow-hidden border-t-4 border-[#007399]">
            <div class="p-6 border-b border-gray-100">
                <h2 class="text-3xl font-bold text-[#005A8D] flex items-center gap-3">
                    âš–ï¸ æ¯æ—¥ä½“é‡æ‰“å¡ç«™
                </h2>
                <p class="text-gray-500 mt-1">æ¯å¤©æ—©ä¸Šç©ºè…¹è®°å½•ï¼Œæ•°æ®ä¿å­˜åœ¨æœ¬åœ°ã€‚è®©æ•°æ®æˆä¸ºä½ çš„åŠ¨åŠ›ã€‚</p>
            </div>

            <div class="p-6 grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Input Area -->
                <div class="lg:col-span-1 space-y-6">
                    <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                        <label class="block text-sm font-bold text-gray-700 mb-2">é€‰æ‹©æ—¥æœŸ</label>
                        <input type="date" id="weightDate" class="w-full p-3 border border-gray-300 rounded-lg outline-none focus:ring-2 focus:ring-[#007399]">
                    </div>
                    <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                        <label class="block text-sm font-bold text-gray-700 mb-2">ä»Šæ—¥ä½“é‡ (kg)</label>
                        <input type="number" id="weightValue" step="0.1" placeholder="ä¾‹å¦‚: 99.5" class="w-full p-3 border border-gray-300 rounded-lg outline-none focus:ring-2 focus:ring-[#007399]">
                    </div>
                    <button onclick="addWeightRecord()" class="w-full bg-[#007399] hover:bg-[#005A8D] text-white font-bold py-3 px-4 rounded-lg transition shadow-md flex justify-center items-center gap-2">
                        <span>â• è®°å½•ä½“é‡</span>
                    </button>
                    
                    <div class="border-t pt-4">
                         <h3 class="font-bold text-gray-700 mb-2">ğŸ¤– AI è¿›åº¦å¤ç›˜</h3>
                         <p class="text-xs text-gray-500 mb-3">è®© Gemini åˆ†æä½ çš„è¿‘æœŸæ•°æ®ï¼Œæ‰¾å‡ºé—®é¢˜æˆ–ç»™äºˆé¼“åŠ±ã€‚</p>
                         <button onclick="analyzeProgress()" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-4 rounded-lg transition shadow-md flex justify-center items-center gap-2">
                            <span id="analyzeBtnText">âœ¨ åˆ†ææˆ‘çš„è¿›åº¦</span>
                        </button>
                    </div>
                </div>

                <!-- Chart Area -->
                <div class="lg:col-span-2">
                    <div class="bg-white p-2 rounded-lg h-full flex flex-col">
                         <div class="flex justify-between items-center mb-4">
                            <h3 class="font-bold text-gray-700">ä½“é‡è¶‹åŠ¿å›¾</h3>
                            <span class="text-sm text-gray-500" id="currentWeightDisplay">å½“å‰: -- kg</span>
                         </div>
                        <div class="chart-container flex-grow" style="height: 300px;">
                            <canvas id="progressChart"></canvas>
                        </div>
                        <div id="analysisResult" class="hidden mt-4 p-4 bg-purple-50 border border-purple-100 rounded-lg text-sm text-purple-900"></div>
                    </div>
                </div>
            </div>

            <!-- Recent History List -->
            <div class="px-6 pb-6">
                <h3 class="font-bold text-gray-700 mb-4">æœ€è¿‘è®°å½•</h3>
                <div class="overflow-x-auto">
                    <table class="min-w-full text-sm text-left text-gray-500">
                        <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                            <tr>
                                <th scope="col" class="px-6 py-3">æ—¥æœŸ</th>
                                <th scope="col" class="px-6 py-3">ä½“é‡ (kg)</th>
                                <th scope="col" class="px-6 py-3">å˜åŒ–</th>
                                <th scope="col" class="px-6 py-3">æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="weightHistoryBody">
                            <!-- Rows will be added here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- AI Assistant Section -->
        <section class="mb-12 bg-white rounded-xl shadow-lg overflow-hidden border-2 border-[#00A6AD]">
            <div class="ai-gradient p-6 text-white">
                <h2 class="text-3xl font-bold flex items-center justify-center gap-3">
                    <span>âœ¨</span> AI æ™ºèƒ½å¥åº·é¡¾é—® <span>âœ¨</span>
                </h2>
                <p class="text-center text-blue-100 mt-2">ç”± Gemini å¤§æ¨¡å‹é©±åŠ¨ï¼Œé’ˆå¯¹æ‚¨çš„ç³–å°¿ç—…å’Œç—›é£ä½“è´¨æä¾›å®æ—¶å»ºè®®</p>
            </div>
            
            <div class="p-6 grid grid-cols-1 md:grid-cols-2 gap-8">
                <!-- Feature 1: Food Analyzer -->
                <div class="bg-gray-50 rounded-lg p-6 border border-gray-200">
                    <h3 class="text-xl font-bold text-[#005A8D] mb-4 flex items-center">
                        ğŸ½ï¸ é£Ÿç‰©â€œæ‰«é›·â€å™¨
                    </h3>
                    <p class="text-sm text-gray-600 mb-4">ä¸ç¡®å®šé£Ÿå ‚çš„è¿™é“èœèƒ½ä¸èƒ½åƒï¼Ÿè¾“å…¥èœåï¼ŒAI ä¼šæ ¹æ®æ‚¨çš„ç—…å²ï¼ˆæ§ç³–+æ§é…¸ï¼‰ç»™å‡ºçº¢ç»¿ç¯åˆ¤æ–­ã€‚</p>
                    <div class="flex gap-2 mb-4">
                        <input type="text" id="foodInput" placeholder="ä¾‹å¦‚ï¼šçº¢çƒ§è‚‰ã€éº»è¾£çƒ«ã€æ¸…è’¸é±¼..." 
                            class="flex-1 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#00A6AD] focus:border-transparent outline-none">
                        <button onclick="analyzeFood()" class="bg-[#007399] hover:bg-[#005A8D] text-white px-6 py-3 rounded-lg font-bold transition-colors flex items-center">
                            <span id="foodBtnText">åˆ†æ</span>
                        </button>
                    </div>
                    <div id="foodResult" class="hidden bg-white p-4 rounded border border-gray-200 text-gray-700 text-sm leading-relaxed min-h-[100px]"></div>
                </div>

                <!-- Feature 2: SOS Motivation -->
                <div class="bg-gray-50 rounded-lg p-6 border border-gray-200">
                    <h3 class="text-xl font-bold text-[#005A8D] mb-4 flex items-center">
                        ğŸ†˜ æ·±å¤œâ€œé˜²ç ´æˆ’â€æ€¥æ•‘
                    </h3>
                    <p class="text-sm text-gray-600 mb-4">æ™šä¸Š11ç‚¹é¥¿å¾—æƒ³ç‚¹å¤–å–ï¼Ÿåœ¨ä¸‹å•å‰ç‚¹å‡»è¿™ä¸ªæŒ‰é’®ï¼Œè·å–é’ˆå¯¹æ€§çš„å¿ƒç†å¹²é¢„ã€‚</p>
                    <button onclick="getMotivation()" class="w-full bg-red-500 hover:bg-red-600 text-white p-4 rounded-lg font-bold text-lg transition-colors shadow-md mb-4 flex justify-center items-center gap-2">
                        <span id="sosBtnIcon">ğŸš¨</span> <span id="sosBtnText">æˆ‘æƒ³ç‚¹å¤–å–ï¼æ•‘æ•‘æˆ‘ï¼</span>
                    </button>
                    <div id="sosResult" class="hidden bg-red-50 p-4 rounded border border-red-100 text-red-800 italic text-center min-h-[80px] flex items-center justify-center"></div>
                </div>
            </div>
        </section>

        <section class="mb-12">
            <h2 class="text-3xl font-bold text-center text-[#005A8D] mb-6">æ ¸å¿ƒç›®æ ‡ï¼š4ä¸ªæœˆå‡é‡ 25kg</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="stat-card">
                    <div class="stat-number text-[#007399]">100<span class="text-2xl">kg</span></div>
                    <div class="stat-label">å½“å‰ä½“é‡</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number text-[#00A6AD]">75<span class="text-2xl">kg</span></div>
                    <div class="stat-label">ç›®æ ‡ä½“é‡</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number text-[#008CA6]">25<span class="text-2xl">kg</span></div>
                    <div class="stat-label">éœ€å‡æ€»é‡</div>
                </div>
            </div>
        </section>

        <section class="bg-white rounded-lg shadow-md p-6 mb-12">
            <h2 class="text-3xl font-bold text-center text-[#005A8D] mb-6">4ä¸ªæœˆå‡é‡ç›®æ ‡åˆ†è§£</h2>
            <p class="text-center text-gray-600 mb-6">æ­¤å›¾è¡¨æ˜¾ç¤ºäº†ä»100kgçš„èµ·ç‚¹åˆ°75kgçš„æœ€ç»ˆç›®æ ‡ï¼Œæ¯ä¸ªæœˆéœ€è¦è¾¾åˆ°çš„é˜¶æ®µæ€§ä½“é‡ã€‚è¿™æ˜¯ä¸€ä¸ªç¨³å¥çš„å‡é‡è·¯å¾„ã€‚</p>
            <div class="chart-container">
                <canvas id="weightLossTimeline"></canvas>
            </div>
        </section>
        
        <section class="mb-12">
            <h2 class="text-3xl font-bold text-center text-[#005A8D] mb-6">æ ¸å¿ƒç­–ç•¥ï¼šç¨³è¡€ç³– + é™å˜Œå‘¤ + ä¼˜ç¡çœ </h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="stat-card bg-[#E0F7FA] border border-[#B2EBF2]">
                    <div class="stat-number text-5xl mb-2">ğŸ“ˆ</div>
                    <div class="stat-label font-bold text-[#007399]">ç¨³å®šè¡€ç³– (é˜²æš´é£Ÿ)</div>
                    <p class="text-gray-600 mt-2">ä¸­åˆå¿…é¡»åƒä¸»é£Ÿï¼Œé˜²æ­¢å¤œé—´ä½è¡€ç³–å¯¼è‡´å¤±æ§æ€§æš´é£Ÿã€‚</p>
                </div>
                <div class="stat-card bg-[#E0F2F1] border border-[#B2DFDB]">
                    <div class="stat-number text-5xl mb-2">ğŸ’§</div>
                    <div class="stat-label font-bold text-[#008CA6]">é™ä½å˜Œå‘¤ (é˜²ç—›é£)</div>
                    <p class="text-gray-600 mt-2">ä¸¥ç¦å–é£Ÿå ‚è‚‰æ±¤å’Œå†…è„ã€‚æ¯æ—¥å¿…é¡»å–è¶³3000mlæ°´ã€‚</p>
                </div>
                <div class="stat-card bg-[#F1F8E9] border border-[#DCEDC8]">
                    <div class="stat-number text-5xl mb-2">ğŸ˜´</div>
                    <div class="stat-label font-bold text-[#689F38]">æ”¹å–„ç¡çœ  (é˜²å¤œå®µ)</div>
                    <p class="text-gray-600 mt-2">ä¸‹åˆ4ç‚¹åä¸¥ç¦å’–å•¡å› ï¼Œä¿è¯11ç‚¹å‰å…¥ç¡ï¼Œé¿å…é¥¥é¥¿ç´ çˆ†å‘ã€‚</p>
                </div>
            </div>
        </section>

        <section class="bg-white rounded-lg shadow-md p-6 mb-12">
            <h2 class="text-3xl font-bold text-center text-[#005A8D] mb-6">ğŸ›‘ â€œä¿å‘½â€åŸåˆ™ï¼šå››å¤§ç¦ä»¤</h2>
            <ul class="space-y-4">
                <li class="flex items-center p-4 bg-red-50 rounded-lg border border-red-200">
                    <span class="text-4xl mr-4">âŒ</span>
                    <div>
                        <h3 class="font-bold text-red-800 text-xl">ç»å¯¹ç¦æ­¢å–é£Ÿå ‚çš„â€œå…è´¹æ±¤â€</h3>
                        <p class="text-red-700">åŸå› æ˜¯ï¼šé«˜å˜Œå‘¤ + é«˜æ²¹è„‚ï¼Œæ˜¯ç—›é£å’Œè‚¥èƒ–çš„ç‚¸å¼¹ã€‚</p>
                    </div>
                </li>
                <li class="flex items-center p-4 bg-red-50 rounded-lg border border-red-200">
                    <span class="text-4xl mr-4">âŒ</span>
                    <div>
                        <h3 class="font-bold text-red-800 text-xl">ç»å¯¹ç¦æ­¢â€œå®Œå…¨ä¸åƒä¸»é£Ÿâ€</h3>
                        <p class="text-red-700">åŸå› æ˜¯ï¼šä¼šå¼•å‘å¤œé—´ä¸¥é‡ä½è¡€ç³–ï¼Œå¯¼è‡´æš´é£Ÿç¢³æ°´ï¼Œå‰åŠŸå°½å¼ƒã€‚</p>
                    </div>
                </li>
                <li class="flex items-center p-4 bg-red-50 rounded-lg border border-red-200">
                    <span class="text-4xl mr-4">âŒ</span>
                    <div>
                        <h3 class="font-bold text-red-800 text-xl">æ™šä¸Šç»å¯¹ç¦æ­¢å–å«å’–å•¡å› é¥®å“</h3>
                        <p class="text-red-700">åŸå› æ˜¯ï¼šå’–å•¡å› å¯¼è‡´æ·±å¤œå…´å¥‹æ— æ³•å…¥ç¡ï¼Œæ˜¯é¥¥é¥¿ç´ çˆ†å‘çš„å…ƒå‡¶ã€‚</p>
                    </div>
                </li>
                <li class="flex items-center p-4 bg-red-50 rounded-lg border border-red-200">
                    <span class="text-4xl mr-4">âŒ</span>
                    <div>
                        <h3 class="font-bold text-red-800 text-xl">æ¸…ç†å®¶ä¸­é›¶é£Ÿé»‘åå•</h3>
                        <p class="text-red-700">ä¸¥ç¦ï¼šç“œå­ï¼ˆçƒ­é‡ç‚¸å¼¹ï¼‰ã€é¦™è•‰ï¼ˆé«˜ç³–ï¼‰ã€ä¸€åˆ‡å¤–å–ï¼ˆé«˜æ²¹é«˜ç›ï¼‰ã€‚</p>
                    </div>
                </li>
            </ul>
        </section>

        <section class="bg-white rounded-lg shadow-md p-6 mb-12">
            <h2 class="text-3xl font-bold text-center text-[#005A8D] mb-6">ğŸ½ï¸ é£Ÿå ‚æˆ˜æœ¯ï¼šåˆé¤â€œè¿‡æ°´â€æ³•</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
                <div>
                    <h3 class="font-bold text-xl text-[#007399] mb-4">åˆé¤å®Œç¾æ¯”ä¾‹</h3>
                    <p class="text-gray-600 mb-6">è¿™æ˜¯ä½ ä¸­åˆé€‰èœçš„é»„é‡‘æ¯”ä¾‹ã€‚è”¬èœå ä¸€åŠï¼Œè›‹ç™½è´¨å’Œä¸»é£Ÿå„å å››åˆ†ä¹‹ä¸€ï¼Œèƒ½æœ€å¤§ç¨‹åº¦ç¨³å®šè¡€ç³–ã€‚</p>
                    <div class="chart-container" style="max-height: 300px;">
                        <canvas id="lunchComposition"></canvas>
                    </div>
                </div>
                <div>
                    <h3 class="font-bold text-xl text-[#007399] mb-4">ä¸¥æ ¼æ‰§è¡Œé¡ºåºå’ŒæŠ€å·§</h3>
                    <ol class="list-decimal list-inside space-y-3 text-gray-700">
                        <li><strong class="text-gray-900">è¿›é£Ÿé¡ºåºï¼š</strong> å…ˆå–æ°´ â” åƒè”¬èœ â” åƒè‚‰ â” æœ€ååƒä¸»é£Ÿã€‚</li>
                        <li><strong class="text-gray-900">ä¸»é£Ÿï¼ˆå¿…åƒï¼‰ï¼š</strong> 1æ‹³å¤´å¤§å°ï¼ˆä¼˜é€‰æ‚ç²®é¥­ã€ç‰ç±³ï¼‰ã€‚</li>
                        <li><strong class="text-gray-900">è›‹ç™½è´¨ï¼š</strong> ä¼˜é€‰å»çš®é¸¡é¸­ã€æ·¡æ°´é±¼ã€é¸¡è›‹ã€‚</li>
                        <li><strong class="text-gray-900">ç—›é£è­¦æƒ•ï¼š</strong> ç¦åƒå†…è„ã€è´ç±»ã€æµ“è‚‰æ±¤ã€‚</li>
                        <li><strong class="text-gray-900">â€œè¿‡æ°´â€åŠ¨ä½œï¼š</strong> å‡†å¤‡ä¸€æ¯æ¸©æ°´ï¼Œæ‰€æœ‰æ²¹è…»ç‚’èœå¿…é¡»æ¶®æ²¹åå†åƒï¼</li>
                        <li><strong class="text-gray-900">é¥­åè¿åŠ¨ï¼š</strong> å¿…é¡»æ•£æ­¥1å…¬é‡Œï¼Œæ¶ˆè€—é¤åè¡€ç³–ã€‚</li>
                    </ol>
                </div>
            </div>
        </section>

        <section class="mb-12">
            <h2 class="text-3xl font-bold text-center text-[#005A8D] mb-6">â° æ¯æ—¥ä¸¥æ ¼æ‰§è¡Œæ—¶åˆ»è¡¨</h2>
            <div class="relative pl-8">
                <div class="absolute left-4 top-0 bottom-0 w-1 bg-[#00A6AD] rounded"></div>
                
                <div class="relative mb-8">
                    <div class="absolute -left-12 top-0 flex items-center justify-center w-10 h-10 bg-[#008CA6] text-white rounded-full font-bold">ğŸŒ…</div>
                    <div class="ml-4 p-6 bg-white rounded-lg shadow-md">
                        <h3 class="font-bold text-xl text-[#007399] mb-2">07:00 - 09:00 æ—©æ™¨</h3>
                        <ul class="list-disc list-inside text-gray-700">
                            <li>èµ·åºŠå– 500ml æ¸©æ°´ (æ³¨æ„ç›‘æµ‹æœè¯åçš„è¡€ç³–)ã€‚</li>
                            <li>ä¿ç•™ç‘å¹¸çƒ­ç¾å¼ï¼ˆæ— ç³–ï¼‰ï¼ŒåŠ é€Ÿä»£è°¢ã€‚</li>
                            <li>çœ‹ä¹¦æ—¶ä¿æŒèƒŒéƒ¨æŒºç›´ï¼Œæ”¶ç´§æ ¸å¿ƒã€‚</li>
                        </ul>
                    </div>
                </div>

                <div class="relative mb-8">
                    <div class="absolute -left-12 top-0 flex items-center justify-center w-10 h-10 bg-[#008CA6] text-white rounded-full font-bold">ğŸŒ</div>
                    <div class="ml-4 p-6 bg-white rounded-lg shadow-md">
                        <h3 class="font-bold text-xl text-[#007399] mb-2">12:00 åˆé¤</h3>
                        <p class="text-gray-700">ä¸¥æ ¼æ‰§è¡Œâ€œé£Ÿå ‚æˆ˜æœ¯â€ï¼ˆè§ä¸Šå›¾ï¼‰ã€‚</p>
                    </div>
                </div>

                <div class="relative mb-8">
                    <div class="absolute -left-12 top-0 flex items-center justify-center w-10 h-10 bg-[#008CA6] text-white rounded-full font-bold">ğŸŒ‡</div>
                    <div class="ml-4 p-6 bg-white rounded-lg shadow-md">
                        <h3 class="font-bold text-xl text-[#007399] mb-2">16:00 é˜²å¾¡æ€§åŠ é¤</h3>
                        <p class="text-gray-700">ä¸ºé˜²æ­¢æ™šé¤å¤±æ§ã€‚é¦–é€‰ï¼šä¸€æ ¹é»„ç“œ/å°ç•ªèŒ„ æˆ– ä¸€å°æ¯æ— ç³–é…¸å¥¶ã€‚</p>
                    </div>
                </div>

                <div class="relative mb-8">
                    <div class="absolute -left-12 top-0 flex items-center justify-center w-10 h-10 bg-[#008CA6] text-white rounded-full font-bold">ğŸŒ†</div>
                    <div class="ml-4 p-6 bg-white rounded-lg shadow-md">
                        <h3 class="font-bold text-xl text-[#007399] mb-2">18:30 - 19:00 æ™šé¤</h3>
                        <ul class="list-disc list-inside text-gray-700">
                            <li>åŸåˆ™ï¼šæ¸…æ·¡ã€ä½ç¢³ã€æ—©åƒã€‚</li>
                            <li>å†…å®¹ï¼šå¤§é‡æ°´ç…®èœ + å°‘é‡é¸¡èƒ¸è‚‰/é¸¡è›‹ã€‚</li>
                            <li>é¥®å“ï¼š<strong class="text-red-600">æ¸©çƒ­çš„ç™½å¼€æ°´</strong>ï¼Œç»å¯¹ç¦æ­¢å’–å•¡ã€‚</li>
                        </ul>
                    </div>
                </div>

                <div class="relative mb-8">
                    <div class="absolute -left-12 top-0 flex items-center justify-center w-10 h-10 bg-[#008CA6] text-white rounded-full font-bold">ğŸŒ™</div>
                    <div class="ml-4 p-6 bg-white rounded-lg shadow-md">
                        <h3 class="font-bold text-xl text-[#007399] mb-2">20:00 - 23:00 æ™šé—´ä¹ æƒ¯æ”¹è‰¯</h3>
                        <ul class="list-disc list-inside text-gray-700">
                            <li><strong class="text-gray-900">çœ‹ä¹¦ä¼˜åŒ–ï¼š</strong> ç«™ç€çœ‹30åˆ†é’Ÿï¼Œæˆ–è¾¹çœ‹ä¹¦è¾¹é å¢™è¹²ã€‚</li>
                            <li><strong class="text-gray-900">é¥¥é¥¿æ€¥æ•‘ï¼š</strong> å”¯ä¸€å…è®¸çš„å¤œå®µæ˜¯ã€é»„ç“œã€‘æˆ–ã€è¥¿çº¢æŸ¿ã€‘ã€‚</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <section class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-12">
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-3xl font-bold text-center text-[#005A8D] mb-6">ğŸ¥¤ â€œæ— ç³–å¯ä¹â€æˆ˜ç•¥</h2>
                <ul class="list-disc list-inside space-y-3 text-gray-700">
                    <li><strong class="text-[#007399]">é“å¾‹1ï¼š</strong> ä¸‹åˆ4ç‚¹å‰å–å®Œã€‚æ™šé¤åä¸¥ç¦ï¼ˆå«å’–å•¡å› ï¼‰ã€‚</li>
                    <li><strong class="text-[#007399]">é“å¾‹2ï¼š</strong> ä¸èƒ½ä»£æ›¿æ°´ã€‚å–ä¸€å¬å¯ä¹ï¼Œå¿…é¡»é¢å¤–å¤šå–ä¸€æ¯ç™½æ°´æ¥æ’é…¸ã€‚</li>
                    <li><strong class="text-[#007399]">é“å¾‹3ï¼š</strong> ä½œä¸ºâ€œé˜²æš´é£Ÿç›¾ç‰Œâ€ã€‚æƒ³åƒç”œç‚¹æ—¶å…ˆå–åŠç“¶ï¼Œèƒ½æœ‰æ•ˆéª—è¿‡å¤§è„‘ã€‚</li>
                </ul>
            </div>
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-3xl font-bold text-center text-[#005A8D] mb-6">ğŸƒâ€â™‚ï¸ â€œå¾®è¿åŠ¨â€ç­–ç•¥</h2>
                <ul class="list-disc list-inside space-y-3 text-gray-700">
                    <li><strong class="text-[#007399]">åˆåï¼ˆå¿…åšï¼‰ï¼š</strong> æ•£æ­¥1å…¬é‡Œã€‚</li>
                    <li><strong class="text-[#007399]">çœ‹ä¹¦æ—¶ï¼š</strong> é å¢™é™è¹²ï¼ˆ1åˆ†é’Ÿ x 3ç»„ï¼‰ï¼Œæé«˜èƒ°å²›ç´ æ•æ„Ÿæ€§ã€‚</li>
                    <li><strong class="text-[#007399]">ç¡å‰ï¼š</strong> ç©ºä¸­è¹¬è½¦ï¼ˆ50-100ä¸ªï¼‰ï¼Œæ¶ˆè€—æœ€åçš„çƒ­é‡ã€‚</li>
                </ul>
            </div>
        </section>

        <footer class="text-center p-6 bg-[#004080] text-white rounded-lg shadow-inner">
            <h2 class="text-2xl font-bold mb-4">ğŸ’Š ç‰¹åˆ«æé†’</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="bg-yellow-100 text-yellow-800 p-4 rounded-lg">
                    <strong class="block">è¯ç‰©è°ƒæ•´ï¼</strong>
                    <p>éšä½“é‡ä¸‹é™ï¼Œå¿…é¡»ç›‘æµ‹è¡€ç³–ï¼Œå¹¶å’¨è¯¢åŒ»ç”Ÿè°ƒæ•´é™ç³–è¯é‡ï¼Œé˜²æ­¢ä½è¡€ç³–ï¼</p>
                </div>
                <div class="bg-blue-100 text-blue-800 p-4 rounded-lg">
                    <strong class="block">ç—›é£è¡¥æ°´ï¼</strong>
                    <p>æ¯å¤©å¿…é¡»å–å¤Ÿ 3000ml æ°´ä¿ƒè¿›å°¿é…¸æ’æ³„ã€‚å’–å•¡åˆ©å°¿ï¼Œå–å®Œè¦é¢å¤–è¡¥æ°´ã€‚</p>
                </div>
            </div>
        </footer>

    </div>

    <script>
        // --- Gemini API Configuration ---
        const apiKey = "gen-lang-client-0685637544"; // Environment will provide key
        const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;

        // --- Helper Function for API Calls ---
        async function callGemini(prompt, systemInstruction = "") {
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }],
                        systemInstruction: { parts: [{ text: systemInstruction }] }
                    })
                });

                if (!response.ok) {
                    throw new Error(`API Error: ${response.status}`);
                }

                const data = await response.json();
                return data.candidates[0].content.parts[0].text;
            } catch (error) {
                console.error("Gemini API Error:", error);
                return "æŠ±æ­‰ï¼ŒAI åŠ©æ‰‹æš‚æ—¶å¼€å°å·®äº†ï¼Œè¯·ç¨åå†è¯•ã€‚";
            }
        }

        // --- Feature 1: Food Analyzer ---
        async function analyzeFood() {
            const input = document.getElementById('foodInput').value;
            if (!input) return;

            const btnText = document.getElementById('foodBtnText');
            const resultDiv = document.getElementById('foodResult');
            
            // Loading State
            btnText.innerHTML = '<span class="loader"></span> åˆ†æä¸­...';
            resultDiv.classList.remove('hidden');
            resultDiv.innerHTML = '<p class="text-gray-500 text-center">æ­£åœ¨æŸ¥è¯¢ GI å€¼å’Œå˜Œå‘¤å«é‡...</p>';

            const systemPrompt = `ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„ä¸´åºŠè¥å…»å¸ˆï¼Œæ­£åœ¨æŒ‡å¯¼ä¸€ä½39å²çš„ç”·æ€§å‡é‡ï¼ˆç›®æ ‡100kg->75kgï¼‰ã€‚
            é‡è¦ç—…å²ï¼šä»–æ‚£æœ‰ã€äºŒå‹ç³–å°¿ç—…ã€‘å’Œã€ç—›é£ã€‘ã€‚
            ä»»åŠ¡ï¼šåˆ†æç”¨æˆ·è¾“å…¥çš„é£Ÿç‰©æ˜¯å¦é€‚åˆä»–åƒã€‚
            è¾“å‡ºæ ¼å¼è¦æ±‚ï¼šè¯·ç”¨Markdownæ ¼å¼ã€‚
            1. é¦–å…ˆç»™å‡ºä¸€ä¸ªEmojiçº¢ç»¿ç¯åˆ¤æ–­ï¼šğŸŸ¢ (æ¨è/å®‰å…¨) / ğŸŸ¡ (é€‚é‡/å°å¿ƒ) / ğŸ”´ (ç¦æ­¢/å±é™©)ã€‚
            2. **è¡€ç³–å½±å“**ï¼šç®€è¿°GIå€¼æˆ–ç³–è´Ÿè·ã€‚
            3. **ç—›é£å½±å“**ï¼šç®€è¿°å˜Œå‘¤å«é‡ã€‚
            4. **å»ºè®®**ï¼šå¦‚æœä¸åƒï¼Œç»™å‡ºæ›¿ä»£æ–¹æ¡ˆï¼›å¦‚æœåƒï¼Œç»™å‡ºåˆ†é‡å»ºè®®ã€‚
            ä¿æŒè¯­æ°”ä¸“ä¸šä½†äº²åˆ‡ã€‚`;

            const userPrompt = `æˆ‘æƒ³åƒï¼š${input}ã€‚è¯·åˆ†æã€‚`;

            try {
                const result = await callGemini(userPrompt, systemPrompt);
                resultDiv.innerHTML = marked.parse(result);
            } catch (e) {
                resultDiv.innerHTML = "ç½‘ç»œé”™è¯¯ï¼Œè¯·é‡è¯•ã€‚";
            } finally {
                btnText.innerText = 'åˆ†æ';
            }
        }

        // --- Feature 2: SOS Motivation ---
        async function getMotivation() {
            const btnText = document.getElementById('sosBtnText');
            const btnIcon = document.getElementById('sosBtnIcon');
            const resultDiv = document.getElementById('sosResult');

            // Loading State
            btnText.innerText = 'æ­£åœ¨ä¸ºæ‚¨å‘¼å«ç´§æ€¥æ”¯æ´...';
            resultDiv.classList.remove('hidden');
            resultDiv.innerHTML = '<p class="text-gray-500">è¿æ¥æ•™ç»ƒä¸­...</p>';

            const systemPrompt = `ä½ æ˜¯ä¸€ä½ä¸¥å‰ä½†è´Ÿè´£ä»»çš„å‡é‡æ•™ç»ƒã€‚ä½ çš„å­¦å‘˜æ˜¯39å²ç”·æ€§ï¼Œ100kgï¼Œæœ‰ç³–å°¿ç—…å’Œç—›é£ã€‚
            ç°åœ¨çš„åœºæ™¯æ˜¯ï¼šæ·±å¤œï¼Œä»–æƒ³ç‚¹å¤–å–/æš´é£Ÿã€‚
            ä»»åŠ¡ï¼šç»™å‡ºä¸€å¥ç®€çŸ­æœ‰åŠ›çš„è¯ï¼ˆä¸è¶…è¿‡50å­—ï¼‰ï¼Œæ‰“æ¶ˆä»–çš„å¿µå¤´ã€‚
            ç­–ç•¥ï¼š
            1. å¯ä»¥æé†’ä»–æ˜æ—©çš„è¡€ç³–æ•°å€¼ã€‚
            2. å¯ä»¥æé†’ä»–ç—›é£å‘ä½œæ—¶çš„å‰§ç—›ã€‚
            3. å¯ä»¥æé†’ä»–æƒ³å‡åˆ°75kgçš„ç›®æ ‡ã€‚
            è¯­æ°”è¦åƒå½“å¤´æ£’å–ï¼Œæˆ–è€…åƒå…„å¼Ÿä¸€æ ·åŠå¯¼ã€‚ä¸è¦é•¿ç¯‡å¤§è®ºã€‚`;

            const userPrompt = "æˆ‘æƒ³ç‚¹å¤–å–ï¼Œæˆ‘å¾ˆé¥¿ï¼Œæˆ‘è¦æ§åˆ¶ä¸ä½äº†ï¼";

            try {
                const result = await callGemini(userPrompt, systemPrompt);
                resultDiv.innerHTML = `<p class="text-xl font-bold text-red-700">"${result}"</p>`;
            } catch (e) {
                resultDiv.innerHTML = "æ·±å‘¼å¸ï¼Œå–æ¯æ°´ï¼Œå†å»ç¡è§‰ï¼";
            } finally {
                btnText.innerText = 'æˆ‘æƒ³ç‚¹å¤–å–ï¼æ•‘æ•‘æˆ‘ï¼';
                btnIcon.innerText = 'ğŸš¨';
            }
        }

        // --- Weight Tracker Logic ---
        let weightHistory = JSON.parse(localStorage.getItem('myWeightHistory')) || [];
        let progressChart;

        // Initial Setup
        document.getElementById('weightDate').valueAsDate = new Date();
        renderWeightHistory();
        initProgressChart();

        function addWeightRecord() {
            const date = document.getElementById('weightDate').value;
            const weight = parseFloat(document.getElementById('weightValue').value);

            if (!date || !weight) {
                alert("è¯·å¡«å†™æ—¥æœŸå’Œä½“é‡ï¼");
                return;
            }

            // Add new record
            weightHistory.push({ date, weight });
            
            // Sort by date
            weightHistory.sort((a, b) => new Date(a.date) - new Date(b.date));
            
            // Save to LocalStorage
            localStorage.setItem('myWeightHistory', JSON.stringify(weightHistory));

            // Update UI
            renderWeightHistory();
            updateProgressChart();
            document.getElementById('weightValue').value = '';
        }

        function deleteWeightRecord(index) {
            if(confirm('ç¡®å®šåˆ é™¤è¿™æ¡è®°å½•å—ï¼Ÿ')) {
                weightHistory.splice(index, 1);
                localStorage.setItem('myWeightHistory', JSON.stringify(weightHistory));
                renderWeightHistory();
                updateProgressChart();
            }
        }

        function renderWeightHistory() {
            const tbody = document.getElementById('weightHistoryBody');
            tbody.innerHTML = '';
            
            // Show last 5 records, reversed (newest first) for list
            const recentHistory = [...weightHistory].reverse().slice(0, 5);
            
            // Update current weight display
            if (weightHistory.length > 0) {
                document.getElementById('currentWeightDisplay').innerText = `å½“å‰: ${weightHistory[weightHistory.length-1].weight} kg`;
            }

            recentHistory.forEach((record, index) => {
                // Calculate change from next record (which is chronologically previous because we reversed)
                let change = '-';
                let changeClass = '';
                // Find the original index to check against the previous day
                const originalIndex = weightHistory.indexOf(record);
                if (originalIndex > 0) {
                    const diff = (record.weight - weightHistory[originalIndex - 1].weight).toFixed(1);
                    if (diff > 0) {
                        change = `+${diff}`;
                        changeClass = 'text-red-500';
                    } else if (diff < 0) {
                        change = `${diff}`;
                        changeClass = 'text-green-600 font-bold';
                    } else {
                        change = '0.0';
                    }
                }

                const row = `<tr class="bg-white border-b hover:bg-gray-50 table-row-animate">
                    <td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">${record.date}</td>
                    <td class="px-6 py-4">${record.weight}</td>
                    <td class="px-6 py-4 ${changeClass}">${change}</td>
                    <td class="px-6 py-4 text-right">
                        <button onclick="deleteWeightRecord(${weightHistory.indexOf(record)})" class="font-medium text-red-600 hover:underline">åˆ é™¤</button>
                    </td>
                </tr>`;
                tbody.innerHTML += row;
            });
        }

        function initProgressChart() {
            const ctx = document.getElementById('progressChart').getContext('2d');
            progressChart = new Chart(ctx, {
                type: 'line',
                data: {
                    datasets: [{
                        label: 'ä½“é‡è¿›ç¨‹ (kg)',
                        data: weightHistory.map(item => ({x: item.date, y: item.weight})),
                        borderColor: '#007399',
                        backgroundColor: 'rgba(0, 115, 153, 0.1)',
                        borderWidth: 2,
                        pointRadius: 4,
                        pointBackgroundColor: '#ffffff',
                        pointBorderColor: '#007399',
                        fill: true,
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            type: 'time',
                            time: {
                                unit: 'day',
                                displayFormats: {
                                    day: 'MM-dd'
                                }
                            },
                            grid: { display: false }
                        },
                        y: {
                            min: 70, // Base min on goal
                            suggestedMax: 105,
                            grid: { color: '#f3f4f6' }
                        }
                    },
                    plugins: {
                        legend: { display: false }
                    }
                }
            });
        }

        function updateProgressChart() {
            progressChart.data.datasets[0].data = weightHistory.map(item => ({x: item.date, y: item.weight}));
            progressChart.update();
        }

        async function analyzeProgress() {
            if (weightHistory.length < 2) {
                alert("è¯·è‡³å°‘è®°å½•2å¤©çš„ä½“é‡æ•°æ®æ‰èƒ½è¿›è¡Œåˆ†æï¼");
                return;
            }

            const btnText = document.getElementById('analyzeBtnText');
            const resultDiv = document.getElementById('analysisResult');
            
            btnText.innerHTML = '<span class="loader"></span> AI æ€è€ƒä¸­...';
            resultDiv.classList.remove('hidden');
            resultDiv.innerHTML = 'æ­£åœ¨è¯»å–æ‚¨çš„ä½“é‡æ•°æ®å¹¶åˆ†æè¶‹åŠ¿...';

            // Prepare data string for AI
            const recentData = weightHistory.slice(-14); // Last 14 records max
            const dataStr = recentData.map(r => `${r.date}: ${r.weight}kg`).join('\n');

            const systemPrompt = `ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„ä½“é‡ç®¡ç†æ•™ç»ƒã€‚
            ç”¨æˆ·ç”»åƒï¼š39å²ç”·æ€§ï¼ŒäºŒå‹ç³–å°¿ç—…ï¼Œç—›é£ï¼Œåˆå§‹ä½“é‡100kgï¼Œç›®æ ‡75kgã€‚
            ä»»åŠ¡ï¼šæ ¹æ®ç”¨æˆ·çš„ä½“é‡è®°å½•è¿›è¡Œâ€œå¤ç›˜â€ã€‚
            åˆ†æè§’åº¦ï¼š
            1. æ€»ä½“è¶‹åŠ¿ï¼ˆæ‰ç§¤å¿«/æ…¢/å¹³å°æœŸï¼‰ã€‚
            2. å¦‚æœæœ‰åå¼¹ï¼Œç»™äºˆå®‰æ…°å’ŒåŸå› æ¨æµ‹ï¼ˆå¦‚å¯èƒ½æ°´è‚¿ã€èšé¤ï¼‰ã€‚
            3. ç»™äºˆå¼ºçƒˆçš„é¼“åŠ±ã€‚
            è¯·ç”¨Markdownæ ¼å¼ï¼Œç®€çŸ­æœ‰åŠ›ï¼Œä¸è¶…è¿‡100å­—ã€‚`;

            const userPrompt = `è¿™æ˜¯æˆ‘æœ€è¿‘çš„ä½“é‡è®°å½•ï¼š\n${dataStr}\nè¯·åˆ†ææˆ‘çš„è¿›åº¦ã€‚`;

            try {
                const result = await callGemini(userPrompt, systemPrompt);
                resultDiv.innerHTML = marked.parse(result);
            } catch (e) {
                resultDiv.innerHTML = "åˆ†æå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•ã€‚";
            } finally {
                btnText.innerText = 'âœ¨ åˆ†ææˆ‘çš„è¿›åº¦';
            }
        }

        // --- Existing Chart Code ---
        const tooltipTitleCallback = (tooltipItems) => {
            const item = tooltipItems[0];
            let label = item.chart.data.labels[item.dataIndex];
            if (Array.isArray(label)) {
                return label.join(' ');
            } else {
                return label;
            }
        };

        const chartColors = {
            blue1: '#004080',
            blue2: '#005A8D',
            blue3: '#007399',
            blue4: '#008CA6',
            blue5: '#00A6AD'
        };

        new Chart(document.getElementById('weightLossTimeline'), {
            type: 'bar',
            data: {
                labels: ['èµ·å§‹ä½“é‡', 'ç¬¬1ä¸ªæœˆç›®æ ‡', 'ç¬¬2ä¸ªæœˆç›®æ ‡', 'ç¬¬3ä¸ªæœˆç›®æ ‡', 'æœ€ç»ˆç›®æ ‡'],
                datasets: [{
                    label: 'ä½“é‡ (kg)',
                    data: [100, 93, 86, 79, 75],
                    backgroundColor: [
                        chartColors.blue1,
                        chartColors.blue2,
                        chartColors.blue3,
                        chartColors.blue4,
                        chartColors.blue5
                    ],
                    borderColor: '#ffffff',
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        callbacks: {
                            title: tooltipTitleCallback
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: false,
                        min: 70,
                        ticks: {
                            color: '#374151'
                        },
                        grid: {
                            color: '#E5E7EB'
                        }
                    },
                    x: {
                        ticks: {
                            color: '#374151'
                        },
                        grid: {
                            display: false
                        }
                    }
                }
            }
        });

        new Chart(document.getElementById('lunchComposition'), {
            type: 'doughnut',
            data: {
                labels: ['è”¬èœ (2ä»½)', 'è›‹ç™½è´¨ (1ä»½)', 'ä¸»é£Ÿ (1ä»½)'],
                datasets: [{
                    label: 'åˆé¤æ¯”ä¾‹',
                    data: [2, 1, 1],
                    backgroundColor: [
                        chartColors.blue5,
                        chartColors.blue3,
                        chartColors.blue1
                    ],
                    hoverOffset: 4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            color: '#374151'
                        }
                    },
                    tooltip: {
                        callbacks: {
                            title: tooltipTitleCallback
                        }
                    }
                }
            }
        });
    </script>

</body>
</html>